---
title: "Análise da base RAIS"
description: |
  Análise em R dos salários referentes a cientistas de dados da na base RAIS. Projeto feito na Semana Data Science na Prática com a Curso-R
author:
  - name: João Vitor Alencar Amorim
    url: https://example.com/joaoalencaramorim
date: 2022-07-23
output:
  distill::distill_article:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
### Perguntas de pesquisa:

1. Quanto ganhou em média um Ciêntista de Dados no Brasil em 2020?
2. Quanto o salário médio varia no tempo?
3. Quanto o salário médio varia regionalmente?
4. Quanto o salário médio varia por características do profissional (gênero, raça/cor, idade)

### Fonte:

1. [Relação Anual de Informações Sociais (RAIS)](https://basedosdados.org/dataset/br-me-rais?bdm_table=microdados_vinculos)

### Premissas:

1.  Cientistas de dados são cadastrados com os seguintes códigos do CBO ([Código Brasileiro de Ocupações](http://www.mtecbo.gov.br/cbosite/pages/pesquisas/BuscaPorCodigo.jsf)):
    1. 252515: Analista de cobrança (instituições financeiras)
    2. 252525: Analista de crédito (instituições financeiras)
    3. 211110: Especialista em pesquisa operacional 
    4. 211205: Estatístico
    5. 211210: Estatístico (estatística aplicada)
    6. 211215: Estatístico teórico
    7. 411035: Auxiliar de estatística
    8. 131120: Gerente de serviços sociais

## Acessando os dados da RAIS
Utilizando o datalake da iniciativa [Base dos Dados](https://basedosdados.org).

```{r}
library(bigrquery)
library(dplyr)
```

```{r, cache = TRUE, eval = FALSE}
# Carregando a biblioteca bigquery
library(bigrquery)
library(dplyr)

# como usaria se fosse lendo de um arquivo
# tabela <- read.csv()
# head(tabela, 5)

bigrquery::bq_auth("jvitor968@gmail.com")

conexao <- dbConnect(
  bigquery(),
  project = "basedosdados",
  dataset = "br_me_rais",
  billing = "meuprimeiroprojetor",
)

# primeiras_cinco_linhas <-  collect(head(select(tbl(conexao, "microdados_vinculos"), everything()), 5))

primeiras_cinco_linhas <- tbl(conexao, "microdados_vinculos") |>
  select(everything()) |>
  head(5) |>
  collect()

#primeiras_cinco_linhas
```

```{r, cache = TRUE, eval = FALSE}
codigos_cbo <- c("252515", "252525", "211110", "211205", "211210", "411035", "211215", "131120")

tabela_microdados_vinculos_tbl <- tbl(conexao, "microdados_vinculos") |>
  select(everything()) |>
  filter(
    ano >= 2013,
    cbo_2002 %in% codigos_cbo
  )

tabela_microdados_vinculos <- collect(tabela_microdados_vinculos_tbl)
```
```{r, eval = FALSE}
readr::write_rds(tabela_microdados_vinculos, "tabela_microdados_vinculos.rds", compress = "xz")
```

```{r}
tabela_microdados_vinculos <- readRDS("tabela_microdados_vinculos.rds")
```


### Quanto a média salarial varia com o tempo?
```{r}
library(ggplot2)

# filter
# select
# mutate
# group_by
# arrange

tabela_medias <- tabela_microdados_vinculos |>
  group_by(ano) |>
  summarise(media_salario = mean(valor_remuneracao_media))

ggplot(tabela_medias) +
  aes(x = ano, y = media_salario) +
  geom_col() +
  scale_x_continuous(breaks = 2013:2020)
```

```{r}
tabela_medias |>
  knitr::kable()
```


### Quanto a média salarial varia regionalmente?
```{r}
tabela_media_uf <- tabela_microdados_vinculos |>
  group_by(sigla_uf) |>
  summarise(
    media_por_regiao = mean(valor_remuneracao_media)
  )
tabela_media_uf

library(forcats)
tabela_media_uf |>
  mutate(sigla_uf = fct_reorder(sigla_uf, media_por_regiao)) |>
  arrange(desc(sigla_uf)) |>
  ggplot() +
  aes(y = sigla_uf, x = media_por_regiao) +
  geom_col() +
  labs(y = "Unidade da Federação", x = "Média Salarial (R$)")
```
#### Utilizando a mediana ao invés da média?
```{r}
tabela_mediana_uf <- tabela_microdados_vinculos |>
  group_by(sigla_uf) |>
  summarise(
    mediana_por_regiao = median(valor_remuneracao_media)
  )
tabela_mediana_uf

library(forcats)
tabela_mediana_uf |>
  mutate(sigla_uf = fct_reorder(sigla_uf, mediana_por_regiao)) |>
  arrange(desc(sigla_uf)) |>
  ggplot() +
  aes(y = sigla_uf, x = mediana_por_regiao) +
  geom_col() +
  labs(y = "Unidade da Federação", x = "Mediana Salarial (R$)")
```
### Os salários variam pelo sexo?
```{r}
tabela_resumo_sexo <- tabela_microdados_vinculos |>
  group_by(sexo) |>
  summarise(
    media = mean(valor_remuneracao_media),
    mediana = median(valor_remuneracao_media)
  )
tabela_resumo_sexo |>
  knitr::kable()
```
### Os salários variam pela etinia?
```{r}
tabela_resumo_raca_cor <- tabela_microdados_vinculos |>
  group_by(raca_cor) |>
  summarise(
    media = mean(valor_remuneracao_media),
    mediana = median(valor_remuneracao_media)
  )
tabela_resumo_raca_cor |>
  knitr::kable()
```
```{r}
tabela_resumo_sexo_raca_cor <- tabela_microdados_vinculos |>
  group_by(sexo, raca_cor) |>
  summarise(
    media = mean(valor_remuneracao_media),
    mediana = median(valor_remuneracao_media)
  )
tabela_resumo_sexo_raca_cor |>
  knitr::kable()
ggplot(tabela_resumo_sexo_raca_cor, 
       aes(x = raca_cor, y = media, fill = sexo)) +
  geom_col(position = 'dodge')
```


### Restrições:

1. Os dados são apenas de vínculos formais.


**Dica:** Distill is a publication format for scientific and technical writing, native to the web. Learn more about using Distill at <https://rstudio.github.io/distill>.
